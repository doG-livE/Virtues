<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!--jQuery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="chat.js"></script>
    <title>VICE development</title>
    <!-- Add some CSS to change client UI -->
    <style>
    body {
        background-color: #343825;
        }
    label, button {
        color: #00ff22;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 20px;
        margin-left: 40px;
        }
     input {
        color: #a39799;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 20px;
        margin-left: 20px;
        }
    </style>

    <script>
        function readPlayerData(_ID) {
            var raw = JSON.stringify({"KEY":"ID","VALUE":_ID,"TABLE_NAME":"VIRTUES_SAVES"});
            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };
            const fetchPromise = fetch("https://3u99pwarzl.execute-api.us-east-2.amazonaws.com/Virtues_dev/", requestOptions);
            fetchPromise.then(response => {
                save1=response.json();
                return save1;
            }).then(result => {
                save1=result.body
                //console.log(save1);
                //console.log(JSON.parse(save1).GET_DATA);
                getStr="?"+JSON.parse(save1).GET_DATA
                //console.log(getStr);
                urlParams = new URLSearchParams(getStr);
                //console.log(urlParams);
                //console.log("l1: "+urlParams.get('l1'));
                $(document).ready(() => {
                    $('#courageField').val(urlParams.get('l1'));
                    $('#compassionField').val(urlParams.get('l2'));
                    $('#cleverField').val(urlParams.get('l3'));
                    $('#moraleField').val(urlParams.get('m'));
                    $('#hopeField').val(urlParams.get('h'));
                    $('#nameField').val(urlParams.get('title'));
                    return save1;
                });
            });
        }

        function updateUser(_ID,_num) {
            var raw = JSON.stringify({"KEY":"ID","VALUE":_ID,"TABLE_NAME":"VIRTUES_SAVES"});
            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };
            const fetchPromise = fetch("https://3u99pwarzl.execute-api.us-east-2.amazonaws.com/Virtues_dev/", requestOptions);
            fetchPromise.then(response => {
                save1=response.json();
                return save1;
            }).then(result => {
                save1=result.body
                //console.log(save1);
                getStr="?"+JSON.parse(save1).GET_DATA
                urlParams = new URLSearchParams(getStr);
                var _IDJSON=JSON.parse(save1);
                $(document).ready(() => {
                    // Add the values for the given player number
                    playerDataAr[_num]=
                        {"courage":urlParams.get('l1'),
                        "compassion":urlParams.get('l2'),
                        "clever":urlParams.get('l3'),
                        "hope":urlParams.get('h'),
                        "morale":urlParams.get('m'),
                        "name":urlParams.get('title'),
                        "inspiration":urlParams.get('IE'),
                        "id":_IDJSON.ID
                    };
                    //console.log(playerDataAr[_num]);
                    // setting the name field
                    $('#idField'+_num).val(playerDataAr[_num].id);
                    $('#nameField'+_num).val(playerDataAr[_num].name);
                    // calculate total inspration
                    var _total=0;
                    for(playerData in playerDataAr) {
                        _total+=parseInt(playerDataAr[playerData].inspiration)
                        //console.log(_total)
                    }
                    $('#totalInspirationField').val(_total);
                    return save1;
                });
            });
        }


        const chatURL = "wss://h86xupi032.execute-api.us-east-2.amazonaws.com/dev/";
        let socket = new WebSocket(chatURL);
        //console.log(socket);
        // send message from the form

        // message received - show the message in div#messages
        socket.onmessage = function(event) {
        let message = event.data;

        let messageElem = document.createElement('div');
        messageElem.textContent = message;
        document.getElementById('messages').prepend(messageElem);
        }


    //////////////
        var myHeaders = new Headers();
        // add content type header to object
        myHeaders.append("Content-Type", "application/json");
        //var results=[];
        var save1="";
        var getStr="";
        var urlParams="";
        var playerDataAr=[];
        var maxMembers=10;

        
    </script>

</head>
<body>
    <form>
         <br><br>
        <label>PLAYER DISPLAY :</label><input type="text" size="10" id="idField" onchange="readPlayerData($('#idField').val())"></input>
        <label>Name :</label><input type="text" size="10" id="nameField"></input><br><br>
        <!-- set button onClick method to call function we defined passing input values as parameters -->
        <!--<textarea rows="6" cols="40" id="chatTextBox" readonly></textarea>
        -->
        <br>
        <label>Chat :</label><input type="text" size="40" id="chatField"></label>
        <button type="button" onclick="sendChatText($('#chatField').val(),$('#idField').val())">Send</button></input>
        <br><br>
        <br><br><br>
        <button type="button" onclick="readPlayerData($('#idField').val())">Update player display stats</button>
        <br><br><br>
    </form>
    <!-- div with messages -->
    <div id="messages"></div>
</body>
</html>
